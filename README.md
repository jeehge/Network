# Network

ë„¤íŠ¸ì›Œí¬ì— ëŒ€í•´ ê³µë¶€í•´ë³´ì!

ê·¸ëŸ°ë° ë‚˜ ë­˜ ê³µë¶€í•´ì•¼ í•˜ëŠ” ê±¸ê¹Œ?

<br>

ìš°ì„ 

Alamofire ğŸ‘‰ [ë§í¬](https://github.com/Alamofire/Alamofire)

ë¶€í„° ë´ì•¼ê² ë‹¤.

ë§í¬ íƒ€ê³  ë“¤ì–´ê°€ì ë§ˆì ë³´ì´ëŠ” ì²« ë¬¸ì¥

```Alamofire is an HTTP networking library written in Swift.```

<br>

AlamofireëŠ” iOS, macOSë¥¼ ìœ„í•œ ìŠ¤ìœ„í”„íŠ¸ ê¸°ë°˜ HTTP ë„¤íŠ¸ì›Œí‚¹ ë¼ì´ë¸ŒëŸ¬ë¦¬ì´ë‹¤.

Appleì˜ Foundation networking ê¸°ë°˜ìœ¼ë¡œ ì¸í„°í˜ì´ìŠ¤ë¥¼ ì œê³µí•˜ì—¬ ì¼ë°˜ì ì¸ ë„¤íŠ¸ì›Œí‚¹ ì‘ì—…ì„ ì‰½ê²Œ í•  ìˆ˜ ìˆë‹¤.

<br>

Appleì˜ Foundation networking ê¸°ë°˜ 

ì´ê²Œ ë¬´ì—‡ì¼ê¹Œ ì´ê²ƒë¶€í„° ì‹œì‘í•´ì•¼ê² ë‹¤. 

<br>

# Foundation ğŸ‘‰ [ë§í¬](https://developer.apple.com/documentation/foundation)

```Access essential data types, collections, and operating-system services to define the base layer of functionality for your app.```

Essential Data Types, ì»¬ë ‰ì…˜ ë° ìš´ì˜ ì²´ì œ ì„œë¹„ìŠ¤ì— ì•¡ì„¸ìŠ¤í•˜ì—¬ ì•±ì— ëŒ€í•œ ê¸°ë³¸ ê¸°ëŠ¥ ë ˆì´ì–´ë¥¼ ì •ì˜í•œë‹¤.

### Overview

Foundation í”„ë ˆì„ì›Œí¬ëŠ” ë°ì´í„° ì €ì¥, í…ìŠ¤íŠ¸ ì²˜ë¦¬, ì‹œê°„ ë° ë‚ ì§œ ê³„ì‚°, ì •ë ¬ ë° í•„í„°ë§, ë„¤íŠ¸ì›Œí‚¹ì„ í†µí•´ ì•± ë° í”„ë ˆì„ì›Œí¬(ë‹¤ë¥¸ í”„ë ˆì„ì›Œí¬ë¥¼ ë§í•˜ëŠ” ë“¯)ì— ëŒ€í•œ ê¸°ë³¸ ê³„ì¸µì„ ì œê³µí•œë‹¤.

Foundationì—ì„œ ì •ì˜í•œ í´ë˜ìŠ¤, í”„ë¡œí† ì½œ, ë°ì´í„° íƒ€ì…ì€ macOS, iOS, watchOS, tvOS ë“± ëª¨ë“  ì• í”Œ SDKì— ì‚¬ìš©ëœë‹¤.

Foundationì€ ë‹¨ì–´ì˜ ì˜ë¯¸ì²˜ëŸ¼ ì• í”Œì„ í†µí•´ ì œê³µë˜ëŠ” ëª¨ë“  ì•±ë“¤ì˜ ê¸°ë³¸ì´ ë˜ëŠ” í”„ë ˆì„ì›Œí¬ì´ë‹¤. 

### Networking

URL Loading System ğŸ‘‰ [ë§í¬](https://developer.apple.com/documentation/foundation/url_loading_system)

Bonjour ğŸ‘‰ [ë§í¬](https://developer.apple.com/documentation/foundation/bonjour)
 
<br>

ì˜¤í˜¸ ğŸ¤¨

ê·¸ëŸ¼ ì´ì œ ë‚´ë¶€ì ìœ¼ë¡œ ë‚´ê°€ ê¶ê¸ˆí–ˆë˜ ë¶€ë¶„ë§Œ ì™ì™ ë½‘ì•„ì„œ ì˜ˆì œë¡œ í•¨ ë´ì•¼ê² ë‹¤

ë‹¤ë¥¸ ì‚¬ëŒì˜ ì½”ë“œë¥¼ ë³´ëŠ” ê²ƒ ë§Œí¼ ì¢‹ì€ ê³µë¶€ê°€ ì—†ë‹¤ê³  í•˜ë‹ˆ ì‹¤ì²œí•´ë³´ì!

<br>


# raywenderlich


URLSession Tutorial: Getting Started ğŸ‘‰ [ë§í¬](https://www.raywenderlich.com/3244963-urlsession-tutorial-getting-started)

URLSession Tutorialì—ì„œëŠ” `HTTP ìš”ì²­ì„ ë§Œë“œëŠ” ë°©ë²•`ê³¼ `ì¼ì‹œ ì¤‘ì§€ ë° ì¬ê°œ`í•  ìˆ˜ ìˆëŠ” ë°©ë²•ì„ ê³µë¶€í•  ìˆ˜ ìˆë‹¤.

iTunes ê²€ìƒ‰ APIë¥¼ ì‚¬ìš©í•˜ì—¬ ë‹¤ìŒ ë…¸ë˜ì˜ 30ì´ˆ ë¯¸ë¦¬ë³´ê¸°ë¥¼ ë‹¤ìš´ë¡œë“œ í•˜ëŠ” ì•±ì„ ë§Œë“¤ì–´ ë´…ì‹œë‹¤.

ë°±ê·¸ë¼ìš´ë“œ ì´ì „ì„ ì§€ì›í•˜ê³  ì§„í–‰ ì¤‘ì¸ ë‹¤ìš´ë¡œë“œë¥¼ ì¼ì‹œ ì¤‘ì§€, ë‹¤ì‹œ ì‹œì‘í•˜ê±°ë‚˜ ì·¨ì†Œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. 

<br>

UrlSession ğŸ‘‰ [ë§í¬](https://developer.apple.com/documentation/foundation/urlsession)

`UrlSession`ì€ HTTP ë° HTTPS ê¸°ë°˜ ìš”ì²­ì„ ì²˜ë¦¬í•˜ê¸° ìœ„í•œ í´ë˜ìŠ¤

`URLSession`ì€ ìš”ì²­ì„ ë³´ë‚´ê³ ë°›ëŠ” í•µì‹¬ ê°ì²´ì´ë‹¤. 

ë˜í•œ `URLSessionConfiguration`ì„ í†µí•´ ë‹¤ìŒ ì„¸ ê°€ì§€ ìœ í˜•ì˜ URLì„ ìƒì„±í•  ìˆ˜ ìˆë‹¤, ğŸ‘‰ [ë§í¬](https://developer.apple.com/documentation/foundation/urlsessionconfiguration)

`default` ê¸°ë³¸ ì„¸ì…˜ êµ¬ì„±í•  ë•Œ ì‚¬ìš© (ì €ì¥ ê°ì²´ ì‚¬ìš© -> ì¿ í‚¤)

`ephemeral` ìºì‹œ, ì¿ í‚¤ë¥¼ ì €ì¥í•˜ì§€ ì•Šì„ ë•Œ ì‚¬ìš©

`background` ì•±ì´ ë°±ê·¸ë¼ìš´ë“œì— ìˆì„ ë•Œ ë‹¤ìš´ë¡œë“œ/ì—…ë¡œë“œ í•  ë•Œ ì‚¬ìš©. ì•± ìì²´ê°€ ì‹œìŠ¤í…œì— ì˜í•´ ì¼ì‹œ ì¤‘ë‹¨ë˜ê±°ë‚˜ ì¢…ë£Œëœ ê²½ìš°ì—ë„ ì „ì†¡ì€ ê³„ì† ë¨

<br>

`URLSessionConfiguration`ì„ ì‚¬ìš©í•˜ë©´ ì‹œê°„ ì´ˆê³¼ ê°’, ìºì‹± ì •ì±… ë° HTTP í—¤ë”ì™€ ê°™ì€ ì„¸ì…˜ ì†ì„±ì„ êµ¬ì„±í•  ìˆ˜ë„ ìˆë‹¤. 

`URLSessionTask`ëŠ” ì‘ì—… ê°œì²´ë¥¼ ë‚˜íƒ€ë‚´ëŠ” ì¶”ìƒ í´ë˜ìŠ¤ì´ë‹¤. 

ì„¸ì…˜ì€ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ê³  íŒŒì¼ì„ ë‹¤ìš´ë¡œë“œí•˜ê±°ë‚˜ ì—…ë¡œë“œí•˜ëŠ” ì‹¤ì œ ì‘ì—…ì„ ìˆ˜í–‰í•˜ëŠ” í•˜ë‚˜ ì´ìƒì˜ taskë¥¼ ìƒì„±í•œë‹¤.

<br>

### Session Task Types

êµ¬ì²´ì ì¸ session taskì—ëŠ” ì„¸ ê°€ì§€ ìœ í˜•ì´ ìˆë‹¤.

`URLSessionDataTask` ğŸ‘‰ [ë§í¬](https://developer.apple.com/documentation/foundation/urlsessiondatatask) : ì„œë²„ë¡œë¶€í„° ë°ì´í„°ë¥¼ ê°€ì ¸ì™€ì„œ ë©”ëª¨ë¦¬ì— ì €ì¥í•˜ëŠ” GET ìš”ì²­ ëŒ€í•˜ ì‘ì—…ì— ì‚¬ìš©

`URLSessionUploadTask` ğŸ‘‰ [ë§í¬](https://developer.apple.com/documentation/foundation/urlsessionuploadtask) : POST ë˜ëŠ” PUT ë©”ì†Œë“œë¥¼ í†µí•´ ë””ìŠ¤í¬ë¡œ ë¶€í„° ì›¹ ì„œë¹„ìŠ¤ë¡œ íŒŒì¼ìœ¼ ì—…ë¡œë“œí•˜ëŠ” ì‘ì—…ì— ì‚¬ìš©

`URLSessionDownloadTask` ğŸ‘‰ [ë§í¬](https://developer.apple.com/documentation/foundation/urlsessiondownloadtask) : ì›ê²© ì„œë¹„ìŠ¤ë¡œë¶€í„° íŒŒì¼ì„ ì„ì‹œ íŒŒì¼ ìœ„ì¹˜ë¡œ ë‹¤ìš´ë¡œë“œí•˜ëŠ” ì‘ì—…ì— ì‚¬ìš©

<img width="624" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-02-12 á„‹á…©á„’á…® 11 12 17" src="https://user-images.githubusercontent.com/8108570/153714754-8470f5b1-c552-45f2-8bb5-f115b838fd00.png">



ì‘ì—…ì„ ì¼ì‹œ ì¤‘ì§€ ë˜ëŠ” ë‹¤ì‹œ ì‹œì‘ ë° ì·¨ì†Œí•  ìˆ˜ ìˆë‹¤.
`URLSessionDownLoadTask`ëŠ” í–¥í›„ ì¬ê°œë¥¼ ìœ„í•´ ì¼ì‹œ ì¤‘ì§€í•  ìˆ˜ ìˆëŠ” ì¶”ê°€ ê¸°ëŠ¥ì´ ìˆë‹¤.

ì¼ë°˜ì ìœ¼ë¡œ `URLSesseion`ì€ ë‘ ê°€ì§€ ë°©ë²•ìœ¼ë¡œ ë°ì´í„°ë¥¼ ë°˜í™˜í•œë‹¤.

 - ì‘ì—…ì´ ì„±ê³µì ìœ¼ë¡œ ëë‚˜ê±°ë‚˜ ì—ëŸ¬ê°€ ë°œìƒí•  ë•Œ, ì™„ë£Œ í•¸ë“¤ëŸ¬ë¥¼ í†µí•´
 - ì„¸ì…˜ì„ ë§Œë“¤ ë•Œ ì„¤ì •í•œ delegateì— ë©”ì„œë“œì˜ í˜¸ì¶œì„ í†µí•´

<br>

### DataTask ë° DownloadTask

ì‚¬ìš©ìì˜ ê²€ìƒ‰ ì¡°ê±´ì„ ìœ„í•´ iTunes Search APIì— ì¿¼ë¦¬í•˜ëŠ” data taskë¥¼ ë§Œë“¬ìœ¼ë¡œì¨ ì‹œì‘í•œë‹¤.

SearchViewController.swiftì—ì„œ `searchBarsearchButtonClicked`ëŠ” ìŠ¤í…Œì´í„°ìŠ¤ë°”ì˜ ë„¤íŠ¸ì›Œí¬ ì¸ë””ì¼€ì´í„°ë¥¼ ì‚¬ìš©í•´ì„œ, ë„¤íŠ¸ì›Œí¬ í”„ë¡œì„¸ì„œê°€ ì‹¤í–‰ ì¤‘ì¸ ì‚¬ìš©ìë¥´ í‘œì‹œí•œë‹¤. ê·¸ëŸ° ë‹¤ìŒ ë„¤íˆ¬ì›Œí¬ ë¦¬í€˜ìŠ¤íŠ¸ë¥¼ ë§Œë“¤ì ë§ˆì QueryService.swift ì•ˆì—ì„œ ì²˜ë¦¬í•˜ëŠ” `getSearchResults(SearchTerm : Formultion :)`ì„ ì´í›„ì— í˜¸ì¶œí•œë‹¤.

ê·¸ëŸ° ë‹¤ìŒ ì—ì„œ ìŠ¤í…ëœ ë¥¼ í˜¸ì¶œí•œë‹¤. ë„¤íŠ¸ì›Œí¬ ìš”ì²­ì„ í•˜ê¸° ìœ„í•´ ë¹Œë“œí•œë‹¤.

QueryService.swiftì—ì„œ `// TODO 1`ì„ ë‹¤ìŒê³¼ ê°™ì´ ë°”ê¾¼ë‹¤.

```
let defaultSession = URLSession(configuration: .default)
```

ê·¸ë¦¬ê³  `// TODO 2` 

```
var dataTask: URLSessionDataTask?
```

defaultSession ì„ ìƒì„±í•˜ê³  APIë¡œ GET ìš”ì²­ì„ ë§Œë“¤ê¸° ìœ„í•´ ìš°ë¦¬ê°€ ì‚¬ìš©í•  URLSessionDataTaskë¥¼ ì •ì˜í–ˆë‹¤.

dataTaskëŠ” ìƒˆë¡œìš´ ê²€ìƒ‰ ë¬¸ìì—´ì´ ë“¤ì–´ì˜¤ ë•Œë§ˆë‹¤ ë‹¤ì‹œ ì´ˆê¸°í™”ëœë‹¤.

getSearchResults(searchTerm:completion:) ë©”ì†Œë“œì˜ ë‚´ë¶€ë¥¼ ë‹¤ìŒì„ ë³€ê²½í•œë‹¤.


```
// 1
dataTask?.cancel()
    
// 2
if var urlComponents = URLComponents(string: "https://itunes.apple.com/search") {
  urlComponents.query = "media=music&entity=song&term=\(searchTerm)"      
  // 3
  guard let url = urlComponents.url else {
    return
  }
  // 4
  dataTask = 
    defaultSession.dataTask(with: url) { [weak self] data, response, error in 
    defer {
      self?.dataTask = nil
    }
    // 5
    if let error = error {
      self?.errorMessage += "DataTask error: " + 
                              error.localizedDescription + "\n"
    } else if 
      let data = data,
      let response = response as? HTTPURLResponse,
      response.statusCode == 200 {       
      self?.updateSearchResults(data)
      // 6
      DispatchQueue.main.async {
        completion(self?.tracks, self?.errorMessage ?? "")
      }
    }
  }
  // 7
  dataTask?.resume()
}
```

ë²ˆí˜¸ê°€ ë§¤ê²¨ì§„ ê° ì£¼ì„ì˜ ë‚´ìš©ê³¼ ê°™ë‹¤.

1. ìƒˆ ì‚¬ìš©ì ì¿¼ë¦¬ì˜ ê²½ìš°, dataTaskë¥¼ ìƒˆë¡œìš´ ì¿¼ë¦¬ ì¬ì‚¬ìš©ì„ ìœ„í•´ ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ëª¨ë“  ë°ì´í„° ì‘ì—…ì„ ì·¨ì†Œí•œë‹¤.
2. query URL ì•ˆì— ì‚¬ìš©ìì˜ ê²€ìƒ‰ ë¬¸ìì—´ì„ í¬í•¨í•˜ë ¤ë©´ ê²€ìƒ‰ ê¸°ë³¸ URLì—ì„œ URLComponentsë¥¼ ë§Œë“  ë‹¤ìŒ query stringì„ ì„¤ì •í•œë‹¤. ì´ë ‡ê²Œ í•˜ë©´ ê²€ìƒˆ ë¬¸ìì—´ì— ì´ìŠ¤ì¼€ì´í”„ëœ ë¬¸ìê°€ ì‚¬ìš©ëœë‹¤. ì˜¤ë¥˜ ë©”ì‹œì§€ê°€ í‘œì‹œë˜ë©´ ì´ [ê²Œì‹œë¬¼](https://forums.raywenderlich.com/t/urlsession-tutorial-getting-started-raywenderlich-com/73741/13)ì„ ì°¸ì¡°! 
3. urlComponentsì˜ url í”„ë¡œí¼í‹°ëŠ” ì˜µì…”ë„ì´ë¯€ë¡œ ì•ˆì „í•˜ê²Œ ì–¸ë˜í•‘í•œë‹¤.
4. ìƒì„±í•œ ì„¸ì…˜ì—ì„œ URLSessionDataTaskë¥¼ ìƒì„±í•œë‹¤. ê·¸ë¦¬ê³  ì‘ì—…ì´ ì™„ë£Œë  ë•Œ í˜¸ì¶œí•  completion handlerë¥¼ í•¨ê»˜ ì „ë‹¬í•œë‹¤.
5. ìš”ì²­ì´ ì„±ê³µí•˜ë©´ ì‘ë‹µ ë°ì´í„°ë¥¼ tracks ë°°ì—´ë¡œ íŒŒì‹±í•˜ëŠ” ë„ìš°ë¯¸ ë©”ì„œë“œ updateSearchResultsë¥¼ í˜¸ì¶œí•œë‹¤.
6. completion handlerì—ê²Œ tracksë¥¼ ì „ë‹¬í•˜ê¸° ìœ„í•´ main queueë¡œ ì „í™˜í•œë‹¤.
7. ëª¨ë“  TaskëŠ” ê¸°ë³¸ì ìœ¼ë¡œ ì¼ì‹œ ì¤‘ë‹¨ëœ ìƒíƒœë¡œ ì‹œì‘ëœë‹¤. resume()ì„ í˜¸ì¶œí•´ì„œ dataTaskë¥¼ ì‹œì‘í•œë‹¤. 

`SearchViewController`ì—ì„œ `getSearchResults(searchTerm:completion:)` í˜¸ì¶œì˜ completion closureë¥¼ ì‚´í´ë³´ì!

ë„¤íŠ¸ì›Œí¬ ì¸ë””ì¼€ì´í„°ë¥¼ ìˆ¨ê¸´ í›„ searchResultsì— resultsë¥¼ ì €ì¥í•œ ë‹¤ìŒ í…Œì´ë¸” ë·°ë¥¼ ì—…ë°ì´íŠ¸í•œë‹¤.

<br>

Note. ê¸°ë³¸ ë¦¬í€˜ìŠ¤íŠ¸ ë©”ì†Œë“œëŠ” `GET`ì´ë‹¤. ë§Œì•½ `PUT, POST, DELETE`ë¥¼ ì›í•œë‹¤ë©´ `URLRequest.HTTPMethod` í”„ë¡œí¼í‹°ë¥¼ ì„¤ì •í•˜ ë‹¤ìŒ dataTaskë¥¼ ìƒì„±í•œë‹¤.

<br>

ì—¬ê¸°ê¹Œì§€ ì‘ì—… í›„ ë¹Œë“œí•˜ë©´ ê³¡ë“¤ì˜ ê²€ìƒ‰ ëª©ë¡ì„ ë³¼ ìˆ˜ ìˆë‹¤. ê·¸ëŸ¬ë‚˜ download í•˜ê¸° ìœ„í•´ì„œ íƒ­ì„ í•´ë„ ì•„ë¬´ ì¼ë„ ì¼ì–´ë‚˜ì§€ ì•ŠëŠ”ë‹¤.

ìŒì•…ì„ ì €ì¥í•˜ê¸° ì‰½ê²Œ `download task`ë¥¼ ì‚¬ìš©í•  ê²ƒ ì´ë‹¤.


ì—¬ëŸ¬ ê°œì˜ ë‹¤ìš´ë¡œë“œë¥¼ ì‚¬ìš©í•˜ê¸° ìœ„í•´ ì²˜ìŒ í•´ì•¼í•  ì¼ì€ ë‹¤ìš´ë¡œë“œ í™œì„± ìƒíƒœë£° ìœ ì§€í•˜ê¸° ìœ„í•œ ì‚¬ìš©ì ì •ì˜ ê°ì²´ì´ë‹¤.

ìƒˆë¡œìš´ Download.swift íŒŒì¼ì„ Model í´ë”ì— ìƒì„±í•œë‹¤.

```
class Download {
  var isDownloading = false
  var progress: Float = 0
  var resumeData: Data?
  var task: URLSessionDownloadTask?
  var track: Track

  init(track: Track) {
    self.track = track
  }
}
```

`Download` í”„ë¡œí¼í‹°ì— ëŒ€í•œ ì„¤ëª…ì€ ë‹¤ìŒê³¼ ê°™ë‹¤.

- isDownloading : ë‹¤ìš´ë¡œë“œê°€ ì •ì§€ ì¤‘ì¸ì§€ ì§„í–‰ ì¤‘ì¸ì§€ í‘œí˜„
- progress: 0.0 ~ 1.0 ì‚¬ì´ì˜ ë‹¤ìš´ë¡œë“œ ì§„í–‰ ìƒíƒœë¥´ ë³´ì—¬ì£¼ëŠ” ë³€ìˆ˜
- resumeData : ì‚¬ìš©ìê°€ download task ë¥¼ ì¤‘ì§€í–ˆì„ ë•Œ, ì§€ê¸ˆê¹Œì§€ ìƒì„±ëœ Dataë¥¼ ì €ì¥í•œë‹¤. ë§Œì•¼ í˜¸ìŠ½ ì„œë²„ê°€ ì§€ì›í•œë‹¤ë©´ ì¤‘ì§€ëœ ë‹¤ìš´ë¡œë“œë¥¼ ì¬ê°œí•  ìˆ˜ ìˆë‹¤.
- task : íŠ¸ë™ì„ ë‹¤ìš´ë¡œë“œ í•˜ëŠ” URLSessionDownloadTask
- track : ë‹¤ìš´ë¡œë“œí•  ëŒ€ì‚¬ íŠ¸ë™, ì´ íŠ¸ë™ìœ¼ URLì€ Download ê°ì²´ì˜ ì‹ë³„ìì´ë‹¤.


** ì°¸ê³ ì‚¬ì´íŠ¸

ì´ë¯¸ ë‚´ê°€ ê³µë¶€ í•˜ë ¤ê³  ë³´ê³  ìˆëŠ” ì´ ë¬¸ì„œë¥¼ ë²ˆì—­í•´ ë‘” ì°©í•˜ ì‚¬ëŒì´ ìˆë‹¤

ğŸ‘‰ [ë§í¬](https://o-o-wl.tistory.com/50)

